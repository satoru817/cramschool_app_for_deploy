<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>素材用html</title>
    <div th:fragment="head" th:remove="tag">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <!-- Bootstrap Icons のCDNを追加 -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <link th:href="@{/css/nav.css}" rel="stylesheet">
        <link rel="stylesheet" th:href="@{/css/style.css}">
        <link rel="stylesheet" th:href="@{/css/pagination.css}">
    </div>
</head>
<body>
<div th:fragment="header" class="bg-light p-3" th:remove="tag">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <!-- メンバー関連 -->
            <div class="btn-group mr-2 ">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                    <i class="bi mr-2 bi-people-fill"></i> メンバー
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item" th:href="@{/studentRegister}"><i class="bi mr-2 bi-person-plus"></i> 生徒登録</a>
                    <a class="dropdown-item" th:href="@{/studentShow}"><i class="bi mr-2 bi-people"></i> 生徒一覧</a>
                    <a class="dropdown-item" th:href="@{/registerSchool}"><i class="bi mr-2 bi-building"></i> 学校登録</a>
                    <div sec:authorize="hasRole('ROLE_ADMIN')">
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" th:href="@{/user/show}"><i class="bi mr-2 bi-list-stars"></i> ユーザー一覧</a>
                        <a class="dropdown-item" th:href="@{/user/register}"><i class="bi mr-2 bi-person-plus-fill"></i> 新規ユーザー作成</a>
                    </div>
                </div>
            </div>

            <!-- ステータス関連 -->
            <div class="btn-group mr-2 ">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                    <i class="bi mr-2 bi-gear"></i> ステータス関連
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item" th:href="@{/editStatus}"><i class="bi mr-2 bi-pencil-square"></i> ステータス編集</a>
                    <a class="dropdown-item" th:href="@{/classEdit}"><i class="bi mr-2 bi-collection"></i> クラス編集</a>
                    <a class="dropdown-item" th:href="@{/studentClassEdit}"><i class="bi mr-2 bi-diagram-3"></i> 所属クラス編集</a>
                    <a class="dropdown-item" th:href="@{/classTeacherLink}"><i class="bi mr-2 bi-link"></i>クラス教師結び付け</a>
                </div>
            </div>

            <!-- 成績関連 -->
            <div class="btn-group mr-2 ">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                    <i class="bi mr-2 bi-graph-up"></i> 成績
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item" th:href="@{/createRegularTest}"><i class="bi mr-2 bi-plus-circle"></i> 定期テスト作成</a>
                    <a class="dropdown-item" th:href="@{/createPastRegularTest}"><i class="bi mr-2 bi-clock-history"></i> 定期テスト作成(過去)</a>
                    <a class="dropdown-item" th:href="@{/showAllRegularTest}"><i class="bi mr-2 bi-list-ul"></i> 定期テスト一覧(学校別）</a>
                    <a class="dropdown-item" th:href="@{/showAllRegularTestInChunks}"><i class="bi mr-2 bi-grid-3x3"></i> 定期テスト一覧(塊)</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" th:href="@{/otherTest/create}"><i class="bi mr-2 bi-file-plus"></i> その他のテスト作成</a>
                    <a class="dropdown-item" th:href="@{/otherTest/show}"><i class="bi mr-2 bi-files"></i> その他のテスト一覧</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" th:href="@{/mockTestRegisterForm}"><i class="bi mr-2 bi-file-arrow-up"></i> 模試CSV登録</a>
                    <a class="dropdown-item" th:href="@{/mockTests}"><i class="bi mr-2 bi-clipboard-data"></i> 模試一覧</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" th:href="@{/registerSchoolRecord}"><i class="bi mr-2 bi-plus-square"></i> 内申一括作成</a>
                    <a class="dropdown-item" th:href="@{/showSchoolRecordSets}"><i class="bi mr-2 bi-collection"></i> 内申編集(セット)</a>
                    <a class="dropdown-item" th:href="@{/showSchoolRecords}"><i class="bi mr-2 bi-building"></i> 内申編集（学校毎)</a>
                </div>
            </div>

            <!-- 営業関連（新規追加） -->
            <div class="btn-group mr-2 ">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                    <i class="bi mr-2 bi-briefcase"></i> 営業
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item" th:href="@{/funnel/index}"><i class="bi mr-2 bi-funnel"></i> ファネル一覧</a>
                    <a class="dropdown-item" th:href="@{/action/index}"><i class="bi mr-2 bi-list-check"></i> アクション一覧</a>
                    <a class="dropdown-item" th:href="@{/sales/inquiry/index}"><i class="bi mr-2 bi-chat-dots"></i> 問合せ一覧</a>
                </div>
            </div>

            <!-- 認証関連 -->
            <div class="btn-group mr-2 ">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                    <i class="bi mr-2 bi-shield-lock"></i> 認証関連
                </button>
                <div class="dropdown-menu">
                    <div th:if="${#authorization.expression('isAuthenticated()')}">
                        <a class="dropdown-item" onclick="event.preventDefault();document.getElementById('logout-form').submit();"><i class="bi mr-2 bi-box-arrow-right"></i> ログアウト</a>
                        <form class="d-none" id="logout-form" th:action="@{/logout}" method="post"></form>
                    </div>
                    <div th:unless="${#authorization.expression('isAuthenticated()')}">
                        <a class="dropdown-item" th:href="@{/login}"><i class="bi mr-2 bi-box-arrow-in-right"></i> ログイン</a>
                    </div>
                </div>
            </div>

            <!-- 塾校舎関連 -->
            <div class="btn-group mr-2 " sec:authorize="hasRole('ROLE_ADMIN')">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                    <i class="bi mr-2 bi-building"></i> 塾校舎関連
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item" th:href="@{/cramSchool/show}"><i class="bi mr-2 bi-list-columns"></i> 塾校舎一覧</a>
                    <a class="dropdown-item" th:href="@{/cramSchool/register}"><i class="bi mr-2 bi-building-add"></i> 塾校舎作成</a>
                </div>
            </div>

            <!-- ユーザー情報表示 -->
            <div class="navbar-nav mr-5">
                <div class="navbar-nav">
                    <div class="navbar-nav">
                        <span class="navbar-text" th:if="${#authorization.expression('isAuthenticated()')}">
                            <i class="bi mr-2 bi-person-circle"></i>
                            <span sec:authentication="principal.username"></span>
                            <span th:text="${#authentication.principal.getCramSchoolName()}"></span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="mr-2">
                <a class="navbar-brand" href="#"></a>
            </div>
        </div>
    </nav>
</div>

<div th:fragment="status_selection" class="container mt-4">
    <h2>ステータス選択</h2>
    <div>
        <label for="statusId">ステータス</label>
        <div class="form-group">
            <div th:each="status : ${statusList}">
                <label class="form-check-label">
                    <input class="form-check-input" type="radio" th:field="*{statusId}" th:value="${status.getStatusId()}">
                    <span th:text="${status.getName()}"></span>
                </label>
            </div>
        </div>
    </div>
</div>

<div th:fragment="mockTestModal">
    <div class="modal fade" id="studentDetailModal" tabindex="-1" role="dialog" aria-labelledby="studentDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studentDetailModalLabel">模試結果詳細</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- 基本情報 -->
                        <div class="col-12 mb-4">
                            <h6 class="border-bottom pb-2">基本情報</h6>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p class="mb-1">生徒名: <span id="modalStudentName"></span></p>
                                </div>
                            </div>
                        </div>

                        <!-- 教科別スコア -->
                        <div class="col-12 mb-4">
                            <h6 class="border-bottom pb-2">教科別スコア</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                    <tr>
                                        <th>教科</th>
                                        <th>点数</th>
                                        <th>偏差値</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>国語</td>
                                        <td id="modalJapanese"></td>
                                        <td id="modalJapaneseSs"></td>
                                    </tr>
                                    <tr>
                                        <td>数学</td>
                                        <td id="modalMath"></td>
                                        <td id="modalMathSs"></td>
                                    </tr>
                                    <tr>
                                        <td>英語</td>
                                        <td id="modalEnglish"></td>
                                        <td id="modalEnglishSs"></td>
                                    </tr>
                                    <tr>
                                        <td>理科</td>
                                        <td id="modalScience"></td>
                                        <td id="modalScienceSs"></td>
                                    </tr>
                                    <tr>
                                        <td>社会</td>
                                        <td id="modalSocial"></td>
                                        <td id="modalSocialSs"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 総合成績 -->
                        <div class="col-12 mb-4">
                            <h6 class="border-bottom pb-2">総合成績</h6>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p class="mb-1">3科目偏差値: <span id="modalJmeSs"></span></p>
                                </div>
                                <div class="col-sm-6">
                                    <p class="mb-1">5科目偏差値: <span id="modalJmessSs"></span></p>
                                </div>
                            </div>
                        </div>

                        <!-- 志望校情報 -->
                        <div class="col-12">
                            <h6 class="border-bottom pb-2">志望校情報</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                    <tr>
                                        <th>志望順位</th>
                                        <th>学校名</th>
                                        <th>合格可能性</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>第1志望</td>
                                        <td id="modalDreamSchool1"></td>
                                        <td id="modalDreamSchool1Probability"></td>
                                    </tr>
                                    <tr>
                                        <td>第2志望</td>
                                        <td id="modalDreamSchool2"></td>
                                        <td id="modalDreamSchool2Probability"></td>
                                    </tr>
                                    <tr>
                                        <td>第3志望</td>
                                        <td id="modalDreamSchool3"></td>
                                        <td id="modalDreamSchool3Probability"></td>
                                    </tr>
                                    <tr>
                                        <td>第4志望</td>
                                        <td id="modalDreamSchool4"></td>
                                        <td id="modalDreamSchool4Probability"></td>
                                    </tr>
                                    <tr>
                                        <td>第5志望</td>
                                        <td id="modalDreamSchool5"></td>
                                        <td id="modalDreamSchool5Probability"></td>
                                    </tr>
                                    <tr>
                                        <td>第6志望</td>
                                        <td id="modalDreamSchool6"></td>
                                        <td id="modalDreamSchool6Probability"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">閉じる</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:fragment="dreamSchool" th:remove="tag">
    <td class="dream-school1 no_wrap" th:text="${result.dreamSchool1}"></td>
    <td class="probability1 no_wrap" th:text="${result.dreamSchool1 == null ? '' : (result.dreamSchool1Probability == null ? '判定不能' : result.dreamSchool1Probability + '%')}"></td>

    <td class="dream-school2 no_wrap" th:text="${result.dreamSchool2}"></td>
    <td class="probability2 no_wrap" th:text="${result.dreamSchool2 == null ? '' : (result.dreamSchool2Probability == null ? '判定不能' : result.dreamSchool2Probability + '%')}"></td>

    <td class="dream-school3 no_wrap" th:text="${result.dreamSchool3}"></td>
    <td class="probability3 no_wrap" th:text="${result.dreamSchool3 == null ? '' : (result.dreamSchool3Probability == null ? '判定不能' : result.dreamSchool3Probability + '%')}"></td>

    <td class="dream-school4 no_wrap" th:text="${result.dreamSchool4}"></td>
    <td class="probability4 no_wrap" th:text="${result.dreamSchool4 == null ? '' : (result.dreamSchool4Probability == null ? '判定不能' : result.dreamSchool4Probability + '%')}"></td>

    <td class="dream-school5 no_wrap" th:text="${result.dreamSchool5}"></td>
    <td class="probability5 no_wrap" th:text="${result.dreamSchool5 == null ? '' : (result.dreamSchool5Probability == null ? '判定不能' : result.dreamSchool5Probability + '%')}"></td>

    <td class="dream-school6 no_wrap" th:text="${result.dreamSchool6}"></td>
    <td class="probability6 no_wrap" th:text="${result.dreamSchool6 == null ? '' : (result.dreamSchool6Probability == null ? '判定不能' : result.dreamSchool6Probability + '%')}"></td>
</div>

<!--テストのタイトル-->
<div th:fragment="regularTestSet" th:remove="tag">
    <div>
        <h5 class="mb-1">
            <span th:text="${test.school.name}" class="fw-bold text-primary"></span> -
            <span th:text="${test.regularTestSet.term} + '年度'"></span>
        </h5>
        <p class="mb-0">
            <span th:text="${test.regularTestSet.grade} + '年生'"></span>
            <span th:text="${test.regularTestSet.semester} + '学期'"></span>
            <span th:if="${test.regularTestSet.isMid == 0}" th:text="'期末テスト'"></span>
            <span th:if="${test.regularTestSet.isMid == 1}" th:text="'中間テスト'"></span>
        </p>
        <small class="text-muted" th:text="'Test ID: ' + ${test.regularTestId}"></small>
    </div>
</div>

<div th:fragment="regularTestResultRow" th:remove="tag">
    <td>
        <a th:href="@{/student/all_score/__${result.student.id}__}" th:text="${result.student.getName()}" class="student-name text-blue-600 hover:text-blue-800 hover:underline"></a>
    </td>
    <td class="text-nowrap">
        <span class="badge badge-info" th:text="${result.klassName}"></span>
    </td>
    <td th:text="${result.japanese}"></td>
    <td th:text="${result.math}"></td>
    <td th:text="${result.english}"></td>
    <td th:text="${result.science}"></td>
    <td th:text="${result.social}"></td>
    <td th:text="${result.music}"></td>
    <td th:text="${result.art}"></td>
    <td th:text="${result.tech}"></td>
    <td th:text="${result.pe}"></td>
    <td th:text="${result.total5}"></td>
    <td th:text="${result.total9}"></td>
</div>


<div th:fragment="subjectAverages" th:remove="tag">
    <div class="d-flex flex-wrap">
        <div class="me-3 mb-3" style="min-width:160px;" th:each="entry : ${subjectAverages}">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0" th:text="${entry.key == 'japanese' ? '国語' :
                                     entry.key == 'math' ? '数学' :
                                     entry.key == 'english' ? '英語' :
                                     entry.key == 'science' ? '理科' :
                                     entry.key == 'social' ? '社会' :
                                     entry.key == 'total5' ? '五科合計' :
                                     entry.key == 'total9' ? '九科合計' :
                                     entry.key == 'art' ? '美術' :
                                     entry.key == 'music' ? '音楽' :
                                     entry.key == 'pe' ? '体育' :
                                     '技術'}">
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped analysis-table" th:data-subject="${entry.key}">
                            <thead>
                            <tr>
                                <th>クラス</th>
                                <th>担当</th>
                                <th>平均点</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="average : ${entry.value}">
                                <td th:text="${average.klassName}"></td>
                                <td th:text="${average.teacherName}"></td>
                                <td th:text="${average.avgScore}" style="text-align: right;"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div th:fragment="script" th:remove="tag">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

</div>

<div th:fragment="footer" th:remove="tag">
    <footer class="text-center mt-auto p-3 bg-light">
        <p class="mb-0">© shoeiApplication</p>
    </footer>
</div>

</body>
</html>
